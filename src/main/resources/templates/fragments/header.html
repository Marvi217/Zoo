<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<nav th:fragment="navbar" class="navbar">
    <a th:href="@{/}" href="/" class="logo">
        ğŸ¾ <span th:text="#{app.name}">PetMarket</span>
    </a>

    <div class="search-container">
        <form th:action="@{/search}" action="/search" method="get">
            <label>
                <input type="text" name="q" th:placeholder="#{nav.search.placeholder}" placeholder="Szukaj produktÃ³w..." required>
            </label>
            <button type="submit" class="search-btn" th:text="#{nav.search.button}">Szukaj</button>
        </form>
    </div>

    <div class="nav-icons">
        <!-- Link dla zalogowanych uÅ¼ytkownikÃ³w -->
        <a sec:authorize="isAuthenticated()"
           th:href="@{/account}"
           class="nav-link">
            <span style="font-size: 20px;">ğŸ‘¤</span>
            <span th:text="#{nav.account}">Konto</span>
        </a>

        <!-- Link dla niezalogowanych uÅ¼ytkownikÃ³w -->
        <a sec:authorize="!isAuthenticated()"
           th:href="@{/login}"
           class="nav-link">
            <span style="font-size: 20px;">ğŸ‘¤</span>
            <span th:text="#{nav.login}">Zaloguj siÄ™</span>
        </a>

        <a th:href="@{/cart}" class="nav-link">
            <div style="position: relative; display: inline-block;">
                ğŸ›’
                <span class="cart-badge" id="cart-badge-count"
                      th:text="${cartItemCount != null ? cartItemCount : (session.cart != null ? session.cart.totalItems : 0)}"
                      th:style="${(cartItemCount == null or cartItemCount == 0) and (session.cart == null or session.cart.totalItems == 0)} ? 'display: none;' : 'display: flex;'">
                    0
                </span>
            </div>
            <span th:text="#{nav.cart}">Koszyk</span>
        </a>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                fetch('/cart/count')
                    .then(response => response.json())
                    .then(data => {
                        const badge = document.getElementById('cart-badge-count');
                        if (badge) {
                            badge.textContent = data.count;
                            badge.style.display = data.count > 0 ? 'flex' : 'none';
                        }
                    })
                    .catch(error => console.error('Failed to fetch cart count from /cart/count:', error));
            });
        </script>
    </div>
</nav>

<!-- CATEGORY BAR FRAGMENT -->
<div th:fragment="categoryBar" class="category-bar" th:if="${globalCategories != null and !#lists.isEmpty(globalCategories)}">
    <a th:each="category : ${globalCategories}"
       th:href="@{/category/{slug}(slug=${category.slug})}"
       class="category-link">
        <span th:text="${category.icon}">ğŸ“¦</span>
        <span th:text="${category.name}">Kategoria</span>
    </a>
</div>

</body>
</html>